#!/usr/bin/env bash
# Install nginx web server

# Update package list and install nginx
apt-get update
apt-get install -y nginx

# Ensure nginx is configured to listen on port 80 (default behavior)
# Create an HTML file to ensure the correct response
echo "Holberton School for the win!" > /var/www/html/index.html

# Start Nginx without using systemctl
nginx

# Confirm that nginx is listening on port 80
if ! netstat -tuln | grep ':80'; then
  echo "Error: Nginx is not listening on port 80"
  exit 1
fi

# Test that Nginx returns the correct status code
RESPONSE=$(curl -sI localhost | head -n 1)

if [[ "$RESPONSE" == "HTTP/1.1 200 OK" ]]; then
  echo "Nginx is working correctly"
else
  echo "Error: Nginx did not return HTTP 200"
  echo "Response: $RESPONSE"
  exit 1
fi
