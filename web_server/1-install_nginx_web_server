#!/usr/bin/env bash
# This script installs Nginx and configures it to listen on port 80

# Update package list
apt-get update -y

# Install Nginx web server
apt-get install nginx -y

# Ensure Nginx is started
service nginx start

# Check if Nginx is listening on port 80
netstat -tuln | grep ':80' || { echo "Nginx is not listening on port 80"; exit 1; }

# Create a custom HTML page that contains "Holberton School"
echo "Holberton School for the win!" > /var/www/html/index.html

# Adjust the Nginx configuration to ensure it listens on port 80 (default)
sed -i 's/listen 80 default_server;/listen 80;/' /etc/nginx/sites-available/default

# Restart Nginx to apply changes (without using systemctl)
nginx -s reload

# Confirm that Nginx is running and responding on the root endpoint
curl -s http://localhost | grep "Holberton School" || { echo "Nginx is not serving the correct page"; exit 1; }

# Output success message
echo "Nginx is successfully installed and serving the correct page on port 80"
